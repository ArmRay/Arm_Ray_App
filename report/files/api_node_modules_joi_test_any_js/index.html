<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - api/node_modules/joi/test/any.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>api/node_modules/joi/test/any.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">72.76</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">1595</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">63.74</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">19.74</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">// Load modules

var Lab = require(&#039;lab&#039;);
var Code = require(&#039;code&#039;);
var Joi = require(&#039;../lib&#039;);
var Helper = require(&#039;./helper&#039;);


// Declare internals

var internals = {};


// Test shortcuts

var lab = exports.lab = Lab.script();
var describe = lab.describe;
var it = lab.it;
var expect = Code.expect;


describe(&#039;any&#039;, function () {

    describe(&#039;#equal&#039;, function () {

        it(&#039;validates valid values&#039;, function (done) {

            Helper.validate(Joi.equal(4), [
                [4, true],
                [5, false]
            ], done);
        });
    });

    describe(&#039;#not&#039;, function () {

        it(&#039;validates invalid values&#039;, function (done) {

            Helper.validate(Joi.not(5), [
                [4, true],
                [5, false]
            ], done);
        });
    });

    describe(&#039;#exist&#039;, function () {

        it(&#039;validates required values&#039;, function (done) {

            Helper.validate(Joi.exist(), [
                [4, true],
                [undefined, false]
            ], done);
        });
    });

    describe(&#039;#strict&#039;, function () {

        it(&#039;validates without converting&#039;, function (done) {

            var schema = Joi.object({
                array: Joi.array().items(Joi.string().min(5), Joi.number().min(3))
            }).strict();

            Helper.validate(schema, [
                [{ array: [&#039;12345&#039;] }, true],
                [{ array: [&#039;1&#039;] }, false],
                [{ array: [3] }, true],
                [{ array: [&#039;12345&#039;, 3] }, true],
                [{ array: [&#039;3&#039;] }, false],
                [{ array: [1] }, false]
            ], done);
        });

        it(&#039;can be disabled&#039;, function (done) {

            var schema = Joi.object({
                array: Joi.array().items(Joi.string().min(5), Joi.number().min(3))
            }).strict().strict(false);

            Helper.validate(schema, [
                [{ array: [&#039;12345&#039;] }, true],
                [{ array: [&#039;1&#039;] }, false],
                [{ array: [3] }, true],
                [{ array: [&#039;12345&#039;, 3] }, true],
                [{ array: [&#039;3&#039;] }, true],
                [{ array: [1] }, false]
            ], done);
        });
    });

    describe(&#039;#options&#039;, function () {

        it(&#039;adds to existing options&#039;, function (done) {

            var schema = Joi.object({ b: Joi.number().strict().options({ convert: true }) });
            var input = { b: &#039;2&#039; };
            schema.validate(input, function (err, value) {

                expect(err).to.not.exist();
                expect(value.b).to.equal(2);
                done();
            });
        });

        it(&#039;throws with an invalid option&#039;, function (done) {

            expect(function () {

                Joi.any().options({ foo: &#039;bar&#039; });
            }).to.throw(&#039;unknown key foo&#039;);
            done();
        });

        it(&#039;throws with an invalid option type&#039;, function (done) {

            expect(function () {

                Joi.any().options({ convert: &#039;yes&#039; });
            }).to.throw(&#039;convert should be of type boolean&#039;);
            done();
        });

        it(&#039;throws with an invalid option value&#039;, function (done) {

            expect(function () {

                Joi.any().options({ presence: &#039;yes&#039; });
            }).to.throw(&#039;presence should be one of required, optional, forbidden, ignore&#039;);
            done();
        });

        it(&#039;does not throw with multiple options including presence key&#039;, function (done) {

            expect(function () {

                Joi.any().options({ presence: &#039;optional&#039;, raw: true });
            }).to.not.throw();
            done();
        });
    });

    describe(&#039;#label&#039;, function () {

        it(&#039;adds to existing options&#039;, function (done) {

            var schema = Joi.object({ b: Joi.string().email().label(&#039;Custom label&#039;) });
            var input = { b: &#039;not_a_valid_email&#039; };
            schema.validate(input, function (err, value) {

                expect(err).to.exist();
                expect(err.details[0].message).to.equal(&#039;&quot;Custom label&quot; must be a valid email&#039;);
                done();
            });
        });

        it(&#039;throws when label is missing&#039;, function (done) {

            expect(function () {

                Joi.label();
            }).to.throw(&#039;Label name must be a non-empty string&#039;);
            done();
        });

        it(&#039;can describe a label&#039;, function (done) {

            var schema = Joi.object().label(&#039;lbl&#039;).describe();
            expect(schema).to.deep.equal({ type: &#039;object&#039;, label: &#039;lbl&#039; });
            done();
        });
    });

    describe(&#039;#strict&#039;, function () {

        it(&#039;adds to existing options&#039;, function (done) {

            var schema = Joi.object({ b: Joi.number().options({ convert: true }).strict() });
            var input = { b: &#039;2&#039; };
            schema.validate(input, function (err, value) {

                expect(err).to.exist();
                expect(value.b).to.equal(&#039;2&#039;);
                done();
            });
        });
    });

    describe(&#039;#raw&#039;, function () {

        it(&#039;gives the raw input&#039;, function (done) {

            var tests = [
                [Joi.array(), &#039;[1,2,3]&#039;],
                [Joi.binary(), &#039;abc&#039;],
                [Joi.boolean(), &#039;false&#039;],
                [Joi.date().format(&#039;YYYYMMDD&#039;), &#039;19700101&#039;],
                [Joi.number(), &#039;12&#039;],
                [Joi.object(), &#039;{ &quot;a&quot;: 1 }&#039;],
                [Joi.any().strict(), &#039;abc&#039;]
            ];

            tests.forEach(function (test) {

                var baseSchema = test[0];
                var input = test[1];
                var schemas = [
                    baseSchema.raw(),
                    baseSchema.raw(true),
                    baseSchema.options({ raw: true })
                ];

                schemas.forEach(function (schema) {

                    schema.raw().validate(input, function (err, value) {

                        expect(err).to.not.exist();
                        expect(value).to.equal(input);
                    });
                });
            });

            done();
        });
    });

    describe(&#039;#default&#039;, function () {

        it(&#039;sets the value&#039;, function (done) {

            var schema = Joi.object({ foo: Joi.string().default(&#039;test&#039;) });
            var input = {};

            schema.validate(input, function (err, value) {

                expect(err).to.not.exist();
                expect(value.foo).to.equal(&#039;test&#039;);
                done();
            });
        });

        it(&#039;throws when value is a method and no description is provided&#039;, function (done) {

            expect(function () {

                Joi.object({
                    foo: Joi.string().default(function () {

                        return &#039;test&#039;;

                    })
                });
            }).to.throw();

            done();
        });

        it(&#039;allows passing description as a property of a default method&#039;, function (done) {

            var defaultFn = function () {

                return &#039;test&#039;;
            };
            defaultFn.description = &#039;test&#039;;

            expect(function () {

                Joi.object({ foo: Joi.string().default(defaultFn) });
            }).to.not.throw();

            done();
        });

        it(&#039;sets the value when passing a method&#039;, function (done) {

            var schema = Joi.object({
                foo: Joi.string().default(function () {

                    return &#039;test&#039;;
                }, &#039;testing&#039;)
            });
            var input = {};

            schema.validate(input, function (err, value) {

                expect(err).to.not.exist();
                expect(value.foo).to.equal(&#039;test&#039;);
                done();
            });
        });

        it(&#039;executes the default method each time validate is called&#039;, function (done) {

            var count = 0;
            var schema = Joi.object({
                foo: Joi.number().default(function () {

                    return ++count;
                }, &#039;incrementer&#039;)
            });
            var input = {};

            schema.validate(input, function (err, value) {

                expect(err).to.not.exist();
                expect(value.foo).to.equal(1);
            });

            schema.validate(input, function (err, value) {

                expect(err).to.not.exist();
                expect(value.foo).to.equal(2);
            });

            done();
        });

        it(&#039;passes a clone of the context if the default method accepts an argument&#039;, function (done) {

            var schema = Joi.object({
                foo: Joi.string().default(function (context) {

                    return context.bar + &#039;ing&#039;;
                }, &#039;testing&#039;),
                bar: Joi.string()
            });
            var input = { bar: &#039;test&#039; };

            schema.validate(input, function (err, value) {

                expect(err).to.not.exist();
                expect(value.foo).to.equal(&#039;testing&#039;);
                done();
            });
        });

        it(&#039;does not modify the original object when modifying the clone in a default method&#039;, function (done) {

            var defaultFn = function (context) {

                context.bar = &#039;broken&#039;;
                return &#039;test&#039;;
            };
            defaultFn.description = &#039;testing&#039;;

            var schema = Joi.object({
                foo: Joi.string().default(defaultFn),
                bar: Joi.string()
            });
            var input = { bar: &#039;test&#039; };

            schema.validate(input, function (err, value) {

                expect(err).to.not.exist();
                expect(value.bar).to.equal(&#039;test&#039;);
                expect(value.foo).to.equal(&#039;test&#039;);
                done();
            });
        });

        it(&#039;passes undefined as the context if the default method has no parent&#039;, function (done) {

            var c;
            var methodCalled = false;
            var schema = Joi.string().default(function (context) {

                methodCalled = true;
                c = context;
                return &#039;test&#039;;
            }, &#039;testing&#039;);

            schema.validate(undefined, function (err, value) {

                expect(err).to.not.exist();
                expect(methodCalled).to.equal(true);
                expect(c).to.equal(undefined);
                expect(value).to.equal(&#039;test&#039;);
                done();
            });
        });

        it(&#039;allows passing a method with no description to default when the object being validated is a function&#039;, function (done) {

            var defaultFn = function () {

                return &#039;just a function&#039;;
            };

            var schema;
            expect(function () {

                schema = Joi.func().default(defaultFn);
            }).to.not.throw();

            schema.validate(undefined, function (err, value) {

                expect(err).to.not.exist();
                expect(value).to.deep.equal(defaultFn);
                done();
            });
        });

        it(&#039;allows passing a method that generates a default method when validating a function&#039;, function (done) {

            var defaultFn = function () {

                return &#039;just a function&#039;;
            };

            var defaultGeneratorFn = function () {

                return defaultFn;
            };
            defaultGeneratorFn.description = &#039;generate a default fn&#039;;

            var schema;
            expect(function () {

                schema = Joi.func().default(defaultGeneratorFn);
            }).to.not.throw();

            schema.validate(undefined, function (err, value) {

                expect(err).to.not.exist();
                expect(value).to.deep.equal(defaultFn);
                done();
            });
        });

        it(&#039;allows passing a ref as a default without a description&#039;, function (done) {

            var schema = Joi.object({
                a: Joi.string(),
                b: Joi.string().default(Joi.ref(&#039;a&#039;))
            });

            schema.validate({ a: &#039;test&#039; }, function (err, value) {

                expect(err).to.not.exist();
                expect(value.a).to.equal(&#039;test&#039;);
                expect(value.b).to.equal(&#039;test&#039;);
                done();
            });
        });

        it(&#039;ignores description when passing a ref as a default&#039;, function (done) {

            var schema = Joi.object({
                a: Joi.string(),
                b: Joi.string().default(Joi.ref(&#039;a&#039;), &#039;this is a ref&#039;)
            });

            schema.validate({ a: &#039;test&#039; }, function (err, value) {

                expect(err).to.not.exist();
                expect(value.a).to.equal(&#039;test&#039;);
                expect(value.b).to.equal(&#039;test&#039;);
                done();
            });
        });

        it(&#039;catches errors in default methods&#039;, function (done) {

            var defaultFn = function () {

                throw new Error(&#039;boom&#039;);
            };
            defaultFn.description = &#039;broken method&#039;;

            var schema = Joi.string().default(defaultFn);

            schema.validate(undefined, function (err, value) {

                expect(err).to.exist();
                expect(err.details).to.have.length(1);
                expect(err.details[0].message).to.contain(&#039;threw an error when running default method&#039;);
                expect(err.details[0].type).to.equal(&#039;any.default&#039;);
                expect(err.details[0].context).to.be.an.instanceof(Error);
                expect(err.details[0].context.message).to.equal(&#039;boom&#039;);
                done();
            });
        });

        it(&#039;should not overide a value when value is given&#039;, function (done) {

            var schema = Joi.object({ foo: Joi.string().default(&#039;bar&#039;) });
            var input = { foo: &#039;test&#039; };

            schema.validate(input, function (err, value) {

                expect(err).to.not.exist();
                expect(value.foo).to.equal(&#039;test&#039;);
                done();
            });
        });

        it(&#039;sets value based on condition (outer)&#039;, function (done) {

            var schema = Joi.object({
                a: Joi.boolean(),
                b: Joi.boolean().default(false).when(&#039;a&#039;, { is: true, then: Joi.required(), otherwise: Joi.forbidden() })
            });

            schema.validate({ a: false }, function (err, value) {

                expect(err).to.not.exist();
                expect(value.b).to.equal(false);
                done();
            });
        });

        it(&#039;sets value based on condition (inner)&#039;, function (done) {

            var schema = Joi.object({
                a: Joi.boolean(),
                b: Joi.boolean().when(&#039;a&#039;, { is: true, then: Joi.default(false), otherwise: Joi.forbidden() })
            });

            schema.validate({ a: true }, function (err, value) {

                expect(err).to.not.exist();
                expect(value.b).to.equal(false);
                done();
            });
        });

        it(&#039;creates deep defaults&#039;, function (done) {

            var schema = Joi.object({
                a: Joi.number().default(42),
                b: Joi.object({
                    c: Joi.boolean().default(true),
                    d: Joi.string()
                }).default()
            }).default();

            Helper.validate(schema, [
                [undefined, true, null, { a: 42, b: { c: true } }],
                [{ a: 24 }, true, null, { a: 24, b: { c: true } }]
            ], done);
        });

        it(&#039;should not affect objects other than object when called without an argument&#039;, function (done) {

            var schema = Joi.object({
                a: Joi.number().default()
            }).default();

            Helper.validate(schema, [
                [undefined, true, null, {}],
                [{ a: 24 }, true, null, { a: 24 }]
            ], done);
        });

        it(&#039;should set default value as a clone&#039;, function (done) {

            var defaultValue = { bar: &#039;val&#039; };
            var schema = Joi.object({ foo: Joi.object().default(defaultValue) });
            var input = {};

            schema.validate(input, function (err, value) {

                expect(err).to.not.exist();
                expect(value.foo).to.not.equal(defaultValue);
                expect(value.foo).to.only.deep.include({ bar: &#039;val&#039; });

                value.foo.bar = &#039;mutated&#039;;

                schema.validate(input, function (err2, value2) {

                    expect(err2).to.not.exist();
                    expect(value2.foo).to.not.equal(defaultValue);
                    expect(value2.foo).to.only.deep.include({ bar: &#039;val&#039; });

                    done();
                });
            });
        });

        it(&#039;should not apply default values if the noDefaults option is enquire&#039;, function (done) {

            var schema = Joi.object({
                a: Joi.string().default(&#039;foo&#039;),
                b: Joi.number()
            });

            var input = { b: 42 };

            Joi.validate(input, schema, { noDefaults: true }, function (err, value) {

                expect(err).to.not.exist();
                expect(value.a).to.not.exist();
                expect(value.b).to.be.equal(42);

                done();
            });
        });

        it(&#039;should not apply default values from functions if the noDefaults option is enquire&#039;, function (done) {

            var func = function (context) {

                return &#039;foo&#039;;
            };

            func.description = &#039;test parameter&#039;;

            var schema = Joi.object({
                a: Joi.string().default(func),
                b: Joi.number()
            });

            var input = { b: 42 };

            Joi.validate(input, schema, { noDefaults: true }, function (err, value) {

                expect(err).to.not.exist();
                expect(value.a).to.not.exist();
                expect(value.b).to.be.equal(42);

                done();
            });
        });

        it(&#039;should not apply default values from references if the noDefaults option is enquire&#039;, function (done) {

            var schema = Joi.object({
                a: Joi.string().default(Joi.ref(&#039;b&#039;)),
                b: Joi.number()
            });

            var input = { b: 42 };

            Joi.validate(input, schema, { noDefaults: true }, function (err, value) {

                expect(err).to.not.exist();
                expect(value.a).to.not.exist();
                expect(value.b).to.be.equal(42);

                done();
            });
        });
    });

    describe(&#039;#optional&#039;, function () {

        it(&#039;validates optional with default required&#039;, function (done) {

            var schema = Joi.object({
                a: Joi.any(),
                b: Joi.any(),
                c: {
                    d: Joi.any()
                }
            }).options({ presence: &#039;required&#039; });

            Helper.validate(schema, [
                [{ a: 5 }, false],
                [{ a: 5, b: 6 }, false],
                [{ a: 5, b: 6, c: {} }, false],
                [{ a: 5, b: 6, c: { d: 7 } }, true],
                [{}, false],
                [{ b: 5 }, false]
            ], done);
        });
    });

    describe(&#039;#forbidden&#039;, function () {

        it(&#039;validates forbidden&#039;, function (done) {

            var schema = {
                a: Joi.number(),
                b: Joi.forbidden()
            };

            Helper.validate(schema, [
                [{ a: 5 }, true],
                [{ a: 5, b: 6 }, false],
                [{ a: &#039;a&#039; }, false],
                [{}, true],
                [{ b: undefined }, true],
                [{ b: null }, false]
            ], done);
        });
    });

    describe(&#039;#strip&#039;, function () {

        it(&#039;validates and returns undefined&#039;, function (done) {

            var schema = Joi.string().strip();

            schema.validate(&#039;test&#039;, function (err, value) {

                expect(err).to.not.exist();
                expect(value).to.not.exist();
                done();
            });
        });

        it(&#039;validates and returns an error&#039;, function (done) {

            var schema = Joi.string().strip();

            schema.validate(1, function (err, value) {

                expect(err).to.exist();
                expect(err.message).to.equal(&#039;&quot;value&quot; must be a string&#039;);
                done();
            });
        });
    });

    describe(&#039;#description&#039;, function () {

        it(&#039;sets the description&#039;, function (done) {

            var b = Joi.description(&#039;my description&#039;);
            expect(b._description).to.equal(&#039;my description&#039;);
            done();
        });

        it(&#039;throws when description is missing&#039;, function (done) {

            expect(function () {

                Joi.description();
            }).to.throw(&#039;Description must be a non-empty string&#039;);
            done();
        });
    });

    describe(&#039;#notes&#039;, function () {

        it(&#039;sets the notes&#039;, function (done) {

            var b = Joi.notes([&#039;a&#039;]).notes(&#039;my notes&#039;);
            expect(b._notes).to.deep.equal([&#039;a&#039;, &#039;my notes&#039;]);
            done();
        });

        it(&#039;throws when notes are missing&#039;, function (done) {

            expect(function () {

                Joi.notes();
            }).to.throw(&#039;Notes must be a non-empty string or array&#039;);
            done();
        });

        it(&#039;throws when notes are invalid&#039;, function (done) {

            expect(function () {

                Joi.notes(5);
            }).to.throw(&#039;Notes must be a non-empty string or array&#039;);
            done();
        });
    });

    describe(&#039;#tags&#039;, function () {

        it(&#039;sets the tags&#039;, function (done) {

            var b = Joi.tags([&#039;tag1&#039;, &#039;tag2&#039;]).tags(&#039;tag3&#039;);
            expect(b._tags).to.include(&#039;tag1&#039;);
            expect(b._tags).to.include(&#039;tag2&#039;);
            expect(b._tags).to.include(&#039;tag3&#039;);
            done();
        });

        it(&#039;throws when tags are missing&#039;, function (done) {

            expect(function () {

                Joi.tags();
            }).to.throw(&#039;Tags must be a non-empty string or array&#039;);
            done();
        });

        it(&#039;throws when tags are invalid&#039;, function (done) {

            expect(function () {

                Joi.tags(5);
            }).to.throw(&#039;Tags must be a non-empty string or array&#039;);
            done();
        });
    });

    describe(&#039;#meta&#039;, function () {

        it(&#039;sets the meta&#039;, function (done) {

            var meta = { prop: &#039;val&#039;, prop2: 3 };
            var b = Joi.meta(meta);
            expect(b.describe().meta).to.deep.equal([meta]);

            b = b.meta({ other: true });
            expect(b.describe().meta).to.deep.equal([meta, {
                other: true
            }]);

            done();
        });

        it(&#039;throws when meta is missing&#039;, function (done) {

            expect(function () {

                Joi.meta();
            }).to.throw(&#039;Meta cannot be undefined&#039;);
            done();
        });
    });

    describe(&#039;#example&#039;, function () {

        it(&#039;sets an example&#039;, function (done) {

            var schema = Joi.valid(5, 6, 7).example(5);
            expect(schema._examples).to.include(5);
            expect(schema.describe().examples).to.deep.equal([5]);
            done();
        });

        it(&#039;throws when tags are missing&#039;, function (done) {

            expect(function () {

                Joi.example();
            }).to.throw(&#039;Missing example&#039;);
            done();
        });

        it(&#039;throws when example fails own rules&#039;, function (done) {

            expect(function () {

                Joi.valid(5, 6, 7).example(4);
            }).to.throw(&#039;Bad example: &quot;value&quot; must be one of [5, 6, 7]&#039;);
            done();
        });
    });

    describe(&#039;#unit&#039;, function () {

        it(&#039;sets the unit&#039;, function (done) {

            var b = Joi.unit(&#039;milliseconds&#039;);
            expect(b._unit).to.equal(&#039;milliseconds&#039;);
            expect(b.describe().unit).to.equal(&#039;milliseconds&#039;);
            done();
        });

        it(&#039;throws when unit is missing&#039;, function (done) {

            expect(function () {

                Joi.unit();
            }).to.throw(&#039;Unit name must be a non-empty string&#039;);
            done();
        });
    });

    describe(&#039;#_validate&#039;, function () {

        it(&#039;checks value after conversion&#039;, function (done) {

            var schema = Joi.number().invalid(2);
            Joi.validate(&#039;2&#039;, schema, { abortEarly: false }, function (err, value) {

                expect(err).to.exist();
                done();
            });
        });
    });

    describe(&#039;#concat&#039;, function () {

        it(&#039;throws when schema is not any&#039;, function (done) {

            expect(function () {

                Joi.string().concat(Joi.number());
            }).to.throw(&#039;Cannot merge type string with another type: number&#039;);
            done();
        });

        it(&#039;throws when schema is missing&#039;, function (done) {

            expect(function () {

                Joi.string().concat();
            }).to.throw(&#039;Invalid schema object&#039;);
            done();
        });

        it(&#039;throws when schema is invalid&#039;, function (done) {

            expect(function () {

                Joi.string().concat(1);
            }).to.throw(&#039;Invalid schema object&#039;);
            done();
        });

        it(&#039;merges two schemas (settings)&#039;, function (done) {

            var a = Joi.number().options({ convert: true });
            var b = Joi.options({ convert: false });

            Helper.validate(a, [
                [1, true], [&#039;1&#039;, true]
            ]);

            Helper.validate(a.concat(b), [
                [1, true], [&#039;1&#039;, false]
            ], done);
        });

        it(&#039;merges two schemas (valid)&#039;, function (done) {

            var a = Joi.string().valid(&#039;a&#039;);
            var b = Joi.string().valid(&#039;b&#039;);

            Helper.validate(a, [
                [&#039;a&#039;, true],
                [&#039;b&#039;, false]
            ]);

            Helper.validate(b, [
                [&#039;b&#039;, true],
                [&#039;a&#039;, false]
            ]);

            Helper.validate(a.concat(b), [
                [&#039;a&#039;, true],
                [&#039;b&#039;, true]
            ], done);
        });

        it(&#039;merges two schemas (invalid)&#039;, function (done) {

            var a = Joi.string().invalid(&#039;a&#039;);
            var b = Joi.invalid(&#039;b&#039;);

            Helper.validate(a, [
                [&#039;b&#039;, true], [&#039;a&#039;, false]
            ]);

            Helper.validate(b, [
                [&#039;a&#039;, true], [&#039;b&#039;, false]
            ]);

            Helper.validate(a.concat(b), [
                [&#039;a&#039;, false], [&#039;b&#039;, false]
            ], done);
        });

        it(&#039;merges two schemas (valid/invalid)&#039;, function (done) {

            var a = Joi.string().valid(&#039;a&#039;).invalid(&#039;b&#039;);
            var b = Joi.string().valid(&#039;b&#039;).invalid(&#039;a&#039;);

            Helper.validate(a, [
                [&#039;a&#039;, true],
                [&#039;b&#039;, false]
            ]);

            Helper.validate(b, [
                [&#039;b&#039;, true],
                [&#039;a&#039;, false]
            ]);

            Helper.validate(a.concat(b), [
                [&#039;a&#039;, false],
                [&#039;b&#039;, true]
            ], done);
        });

        it(&#039;merges two schemas (tests)&#039;, function (done) {

            var a = Joi.number().min(5);
            var b = Joi.number().max(10);

            Helper.validate(a, [
                [4, false], [11, true]
            ]);

            Helper.validate(b, [
                [6, true], [11, false]
            ]);

            Helper.validate(a.concat(b), [
                [4, false], [6, true], [11, false]
            ], done);
        });

        it(&#039;merges two schemas (flags)&#039;, function (done) {

            var a = Joi.string().valid(&#039;a&#039;);
            var b = Joi.string().insensitive();

            Helper.validate(a, [
                [&#039;a&#039;, true], [&#039;A&#039;, false], [&#039;b&#039;, false]
            ]);

            Helper.validate(a.concat(b), [
                [&#039;a&#039;, true], [&#039;A&#039;, true], [&#039;b&#039;, false]
            ], done);
        });

        it(&#039;overrides and append information&#039;, function (done) {

            var a = Joi.description(&#039;a&#039;).unit(&#039;a&#039;).tags(&#039;a&#039;).example(&#039;a&#039;);
            var b = Joi.description(&#039;b&#039;).unit(&#039;b&#039;).tags(&#039;b&#039;).example(&#039;b&#039;);

            var desc = a.concat(b).describe();
            expect(desc).to.deep.equal({
                type: &#039;any&#039;,
                description: &#039;b&#039;,
                tags: [&#039;a&#039;, &#039;b&#039;],
                examples: [&#039;a&#039;, &#039;b&#039;],
                unit: &#039;b&#039;
            });
            done();
        });

        it(&#039;merges two objects (any key + specific key)&#039;, function (done) {

            var a = Joi.object();
            var b = Joi.object({ b: 1 });

            Helper.validate(a, [
                [{ b: 1 }, true], [{ b: 2 }, true]
            ]);

            Helper.validate(b, [
                [{ b: 1 }, true], [{ b: 2 }, false]
            ]);

            Helper.validate(a.concat(b), [
                [{ b: 1 }, true], [{ b: 2 }, false]
            ]);

            Helper.validate(b.concat(a), [
                [{ b: 1 }, true], [{ b: 2 }, false]
            ], done);
        });

        it(&#039;merges two objects (no key + any key)&#039;, function (done) {

            var a = Joi.object({});
            var b = Joi.object();

            Helper.validate(a, [
                [{}, true], [{ b: 2 }, false]
            ]);

            Helper.validate(b, [
                [{}, true], [{ b: 2 }, true]
            ]);

            Helper.validate(a.concat(b), [
                [{}, true], [{ b: 2 }, false]
            ]);

            Helper.validate(b.concat(a), [
                [{}, true], [{ b: 2 }, false]
            ], done);
        });

        it(&#039;merges two objects (key + key)&#039;, function (done) {

            var a = Joi.object({ a: 1 });
            var b = Joi.object({ b: 2 });

            Helper.validate(a, [
                [{ a: 1 }, true], [{ b: 2 }, false]
            ]);

            Helper.validate(b, [
                [{ a: 1 }, false], [{ b: 2 }, true]
            ]);

            Helper.validate(a.concat(b), [
                [{ a: 1 }, true], [{ b: 2 }, true]
            ]);

            Helper.validate(b.concat(a), [
                [{ a: 1 }, true], [{ b: 2 }, true]
            ], done);
        });

        it(&#039;merges two objects (renames)&#039;, function (done) {

            var a = Joi.object({ a: 1 }).rename(&#039;c&#039;, &#039;a&#039;);
            var b = Joi.object({ b: 2 }).rename(&#039;d&#039;, &#039;b&#039;);

            a.concat(b).validate({ c: 1, d: 2 }, function (err, value) {

                expect(err).to.not.exist();
                expect(value).to.deep.equal({ a: 1, b: 2 });
                done();
            });
        });

        it(&#039;merges two objects (deps)&#039;, function (done) {

            var a = Joi.object({ a: 1 });
            var b = Joi.object({ b: 2 }).and(&#039;b&#039;, &#039;a&#039;);

            a.concat(b).validate({ a: 1, b: 2 }, function (err, value) {

                expect(err).to.not.exist();
                done();
            });
        });

        it(&#039;merges two objects (same key)&#039;, function (done) {

            var a = Joi.object({ a: 1, b: 2, c: 3 });
            var b = Joi.object({ b: 1, c: 2, a: 3 });

            var ab = a.concat(b);

            Helper.validate(a, [
                [{ a: 1, b: 2, c: 3 }, true],
                [{ a: 3, b: 1, c: 2 }, false]
            ]);

            Helper.validate(b, [
                [{ a: 1, b: 2, c: 3 }, false],
                [{ a: 3, b: 1, c: 2 }, true]
            ]);

            Helper.validate(ab, [
                [{ a: 1, b: 2, c: 3 }, true],
                [{ a: 3, b: 1, c: 2 }, true],
                [{ a: 1, b: 2, c: 2 }, true],
                [{ a: 1, b: 2, c: 4 }, false]
            ], done);
        });

        it(&#039;throws when schema key types do not match&#039;, function (done) {

            var a = Joi.object({ a: Joi.number() });
            var b = Joi.object({ a: Joi.string() });

            expect(function () {

                a.concat(b);
            }).to.throw(&#039;Cannot merge type number with another type: string&#039;);
            done();
        });

        it(&#039;merges two alternatives with references&#039;, function (done) {

            var schema = {
                a: { c: Joi.number() },
                b: Joi.alternatives(Joi.ref(&#039;a.c&#039;)).concat(Joi.alternatives(Joi.ref(&#039;c&#039;))),
                c: Joi.number()
            };

            Helper.validate(schema, [
                [{ a: {} }, true],
                [{ a: { c: &#039;5&#039; }, b: 5 }, true],
                [{ a: { c: &#039;5&#039; }, b: 6, c: &#039;6&#039; }, true],
                [{ a: { c: &#039;5&#039; }, b: 7, c: &#039;6&#039; }, false]
            ], done);
        });

        it(&#039;merges meta properly&#039;, function (done) {

            var metaA = { a: 1 };
            var metaB = { b: 1 };
            var a = Joi.any().meta(metaA);
            var b = Joi.any().meta(metaB);
            var c = Joi.any();
            var d = Joi.any();

            expect(a.concat(b)._meta).to.deep.equal([{ a: 1 }, { b: 1 }]);
            expect(a.concat(c)._meta).to.deep.equal([metaA]);
            expect(b.concat(c)._meta).to.deep.equal([metaB]);
            expect(c.concat(d)._meta).to.deep.equal([]);

            done();
        });

        it(&#039;merges into an any&#039;, function (done) {

            var a = Joi.any().required();
            var b = Joi.number().only(0);

            expect(function () {

                a.concat(b);
            }).to.not.throw();

            var schema = a.concat(b);
            expect(schema.validate().error.message).to.equal(&#039;&quot;value&quot; is required&#039;);
            expect(schema.validate(1).error.message).to.equal(&#039;&quot;value&quot; must be one of [0]&#039;);

            done();
        });
    });

    describe(&#039;#when&#039;, function () {

        it(&#039;throws when options are invalid&#039;, function (done) {

            expect(function () {

                Joi.when(&#039;a&#039;);
            }).to.throw(&#039;Invalid options&#039;);
            done();
        });

        it(&#039;forks type into alternatives&#039;, function (done) {

            var schema = {
                a: Joi.any(),
                b: Joi.string().valid(&#039;x&#039;).when(&#039;a&#039;, { is: 5, then: Joi.valid(&#039;y&#039;), otherwise: Joi.valid(&#039;z&#039;) })
            };

            Helper.validate(schema, [
                [{ a: 5, b: &#039;x&#039; }, true],
                [{ a: 5, b: &#039;y&#039; }, true],
                [{ a: 5, b: &#039;z&#039; }, false],
                [{ a: 1, b: &#039;x&#039; }, true],
                [{ a: 1, b: &#039;y&#039; }, false],
                [{ a: 1, b: &#039;z&#039; }, true],
                [{ a: 5, b: &#039;a&#039; }, false],
                [{ b: &#039;a&#039; }, false]
            ], done);
        });

        it(&#039;forks type into alternatives (only then)&#039;, function (done) {

            var schema = {
                a: Joi.any(),
                b: Joi.string().valid(&#039;x&#039;).when(&#039;a&#039;, { is: 5, then: Joi.valid(&#039;y&#039;) })
            };

            Helper.validate(schema, [
                [{ a: 5, b: &#039;x&#039; }, true],
                [{ a: 5, b: &#039;y&#039; }, true],
                [{ a: 5, b: &#039;z&#039; }, false],
                [{ a: 1, b: &#039;x&#039; }, true],
                [{ a: 1, b: &#039;y&#039; }, false],
                [{ a: 1, b: &#039;z&#039; }, false],
                [{ a: 5, b: &#039;a&#039; }, false],
                [{ b: &#039;a&#039; }, false]
            ], done);
        });

        it(&#039;forks type into alternatives (only otherwise)&#039;, function (done) {

            var schema = {
                a: Joi.any(),
                b: Joi.string().valid(&#039;x&#039;).when(&#039;a&#039;, { is: 5, otherwise: Joi.valid(&#039;z&#039;) })
            };

            Helper.validate(schema, [
                [{ a: 5, b: &#039;x&#039; }, true],
                [{ a: 5, b: &#039;y&#039; }, false],
                [{ a: 5, b: &#039;z&#039; }, false],
                [{ a: 1, b: &#039;x&#039; }, true],
                [{ a: 1, b: &#039;y&#039; }, false],
                [{ a: 1, b: &#039;z&#039; }, true],
                [{ a: 5, b: &#039;a&#039; }, false],
                [{ b: &#039;a&#039; }, false]
            ], done);
        });

        it(&#039;forks type into alternatives (with a schema)&#039;, function (done) {

            var schema = {
                a: Joi.any(),
                b: Joi.string().valid(&#039;x&#039;).when(&#039;a&#039;, { is: Joi.number().only(5).required(), then: Joi.valid(&#039;y&#039;) })
            };

            Helper.validate(schema, [
                [{ a: 5, b: &#039;x&#039; }, true],
                [{ a: 5, b: &#039;y&#039; }, true],
                [{ a: 5, b: &#039;z&#039; }, false],
                [{ a: 1, b: &#039;x&#039; }, true],
                [{ a: 1, b: &#039;y&#039; }, false],
                [{ a: 1, b: &#039;z&#039; }, false],
                [{ a: 5, b: &#039;a&#039; }, false],
                [{ b: &#039;a&#039; }, false]
            ], done);
        });

        it(&#039;makes peer required&#039;, function (done) {

            var schema = {
                a: Joi.when(&#039;b&#039;, { is: 5, then: Joi.required() }),
                b: Joi.any()
            };

            Helper.validate(schema, [
                [{ b: 5 }, false],
                [{ b: 6 }, true],
                [{ a: &#039;b&#039; }, true],
                [{ b: 5, a: &#039;x&#039; }, true]
            ], done);
        });
    });

    describe(&#039;#requiredKeys&#039;, function () {

        it(&#039;should set keys as required&#039;, function (done) {

            var schema = Joi.object({ a: 0, b: 0, c: { d: 0, e: { f: 0 } }, g: { h: 0 } })
                .requiredKeys(&#039;a&#039;, &#039;b&#039;, &#039;c.d&#039;, &#039;c.e.f&#039;, &#039;g&#039;);
            Helper.validate(schema, [
                [{}, false],
                [{ a: 0 }, false],
                [{ a: 0, b: 0 }, false],
                [{ a: 0, b: 0, g: {} }, true],
                [{ a: 0, b: 0, c: {}, g: {} }, false],
                [{ a: 0, b: 0, c: { d: 0 }, g: {} }, true],
                [{ a: 0, b: 0, c: { d: 0, e: {} }, g: {} }, false],
                [{ a: 0, b: 0, c: { d: 0, e: { f: 0 } }, g: {} }, true]
            ], done);
        });

        it(&#039;should work on types other than objects&#039;, function (done) {

            var schemas = [Joi.array(), Joi.binary(), Joi.boolean(), Joi.date(), Joi.func(), Joi.number(), Joi.string()];
            schemas.forEach(function (schema) {

                expect(function () {

                    schema.applyFunctionToChildren([&#039;&#039;], &#039;required&#039;);
                }).to.not.throw();

                expect(function () {

                    schema.applyFunctionToChildren([&#039;&#039;, &#039;a&#039;], &#039;required&#039;);
                }).to.throw();

                expect(function () {

                    schema.applyFunctionToChildren([&#039;a&#039;], &#039;required&#039;);
                }).to.throw();
            });

            done();
        });

        it(&#039;should throw on unknown key&#039;, function (done) {

            expect(function () {

                Joi.object({ a: 0, b: 0 }).requiredKeys(&#039;a&#039;, &#039;c&#039;, &#039;b&#039;, &#039;d&#039;, &#039;d.e.f&#039;);
            }).to.throw(Error, &#039;unknown key(s) c, d&#039;);

            expect(function () {

                Joi.object({ a: 0, b: 0 }).requiredKeys(&#039;a&#039;, &#039;b&#039;, &#039;a.c.d&#039;);
            }).to.throw(Error, &#039;unknown key(s) a.c.d&#039;);

            done();
        });

        it(&#039;should throw on empty object&#039;, function (done) {

            expect(function () {

                Joi.object().requiredKeys(&#039;a&#039;, &#039;c&#039;, &#039;b&#039;, &#039;d&#039;);
            }).to.throw(Error, &#039;unknown key(s) a, b, c, d&#039;);
            done();
        });

        it(&#039;should not modify original object&#039;, function (done) {

            var schema = Joi.object({ a: 0 });
            var requiredSchema = schema.requiredKeys(&#039;a&#039;);
            schema.validate({}, function (err) {

                expect(err).to.not.exist();

                requiredSchema.validate({}, function (err) {

                    expect(err).to.exist();
                    done();
                });
            });
        });
    });

    describe(&#039;#optionalKeys&#039;, function () {

        it(&#039;should set keys as optional&#039;, function (done) {

            var schema = Joi.object({ a: Joi.number().required(), b: Joi.number().required() }).optionalKeys(&#039;a&#039;, &#039;b&#039;);
            Helper.validate(schema, [
                [{}, true],
                [{ a: 0 }, true],
                [{ a: 0, b: 0 }, true]
            ], done);
        });
    });

    describe(&#039;#empty&#039;, function () {

        it(&#039;should void values when considered empty&#039;, function (done) {

            var schema = Joi.string().empty(&#039;&#039;);
            Helper.validate(schema, [
                [undefined, true, null, undefined],
                [&#039;abc&#039;, true, null, &#039;abc&#039;],
                [&#039;&#039;, true, null, undefined]
            ], done);
        });

        it(&#039;should override any previous empty&#039;, function (done) {

            var schema = Joi.string().empty(&#039;&#039;).empty(&#039;abc&#039;);
            Helper.validate(schema, [
                [undefined, true, null, undefined],
                [&#039;abc&#039;, true, null, undefined],
                [&#039;&#039;, false, null, &#039;&quot;value&quot; is not allowed to be empty&#039;],
                [&#039;def&#039;, true, null, &#039;def&#039;]
            ], done);
        });

        it(&#039;should be possible to reset the empty value&#039;, function (done) {

            var schema = Joi.string().empty(&#039;&#039;).empty();
            Helper.validate(schema, [
                [undefined, true, null, undefined],
                [&#039;abc&#039;, true, null, &#039;abc&#039;],
                [&#039;&#039;, false, null, &#039;&quot;value&quot; is not allowed to be empty&#039;]
            ], done);
        });

        it(&#039;should have no effect if only reset is used&#039;, function (done) {

            var schema = Joi.string().empty();
            Helper.validate(schema, [
                [undefined, true, null, undefined],
                [&#039;abc&#039;, true, null, &#039;abc&#039;],
                [&#039;&#039;, false, null, &#039;&quot;value&quot; is not allowed to be empty&#039;]
            ], done);
        });

        it(&#039;should work with dependencies&#039;, function (done) {

            var schema = Joi.object({
                a: Joi.string().empty(&#039;&#039;),
                b: Joi.string().empty(&#039;&#039;)
            }).or(&#039;a&#039;, &#039;b&#039;);

            Helper.validate(schema, [
                [{}, false, null, &#039;&quot;value&quot; must contain at least one of [a, b]&#039;],
                [{ a: &#039;&#039; }, false, null, &#039;&quot;value&quot; must contain at least one of [a, b]&#039;],
                [{ a: &#039;a&#039; }, true, null, { a: &#039;a&#039; }],
                [{ a: &#039;&#039;, b: &#039;b&#039; }, true, null, { b: &#039;b&#039; }]
            ], done);
        });
    });

    describe(&#039;Set&#039;, function () {

        describe(&#039;#add&#039;, function () {

            it(&#039;throws when adding a non ref function&#039;, function (done) {

                expect(function () {

                    Joi.valid(function () { });
                }).to.throw(&#039;Value cannot be an object or function&#039;);
                done();
            });

            it(&#039;throws when adding an object function&#039;, function (done) {

                expect(function () {

                    Joi.valid({});
                }).to.throw(&#039;Value cannot be an object or function&#039;);
                done();
            });
        });

        describe(&#039;#has&#039;, function () {

            it(&#039;compares date to null&#039;, function (done) {

                var any = Joi.any().clone();
                any._valids.add(null);
                expect(any._valids.has(new Date())).to.equal(false);
                done();
            });

            it(&#039;compares buffer to null&#039;, function (done) {

                var any = Joi.any().clone();
                any._valids.add(null);
                expect(any._valids.has(new Buffer(&#039;&#039;))).to.equal(false);
                done();
            });
        });

        describe(&#039;#values&#039;, function () {

            it(&#039;returns array&#039;, function (done) {

                var a = Joi.any().valid(&#039;x&#039;).invalid(&#039;y&#039;);
                var b = a.invalid(&#039;x&#039;);
                expect(a._valids.values().length).to.equal(1);
                expect(b._valids.values().length).to.equal(0);
                expect(a._invalids.values().length).to.equal(1);
                expect(b._invalids.values().length).to.equal(2);
                done();
            });

            it(&#039;strips undefined&#039;, function (done) {

                var any = Joi.any().clone();
                any._valids.add(undefined);
                expect(any._valids.values({ stripUndefined: true })).to.not.include(undefined);
                done();
            });
        });

        describe(&#039;#allow&#039;, function () {

            it(&#039;allows valid values to be set&#039;, function (done) {

                expect(function () {

                    Joi.any().allow(true, 1, &#039;hello&#039;, new Date());
                }).not.to.throw();
                done();
            });

            it(&#039;throws when passed undefined&#039;, function (done) {

                expect(function () {

                    Joi.any().allow(undefined);
                }).to.throw(Error, &#039;Cannot call allow/valid/invalid with undefined&#039;);
                done();
            });
        });

        describe(&#039;#valid&#039;, function () {

            it(&#039;allows valid values to be set&#039;, function (done) {

                expect(function () {

                    Joi.any().valid(true, 1, &#039;hello&#039;, new Date());
                }).not.to.throw();
                done();
            });

            it(&#039;throws when passed undefined&#039;, function (done) {

                expect(function () {

                    Joi.any().valid(undefined);
                }).to.throw(Error, &#039;Cannot call allow/valid/invalid with undefined&#039;);
                done();
            });
        });

        describe(&#039;#invalid&#039;, function () {

            it(&#039;allows invalid values to be set&#039;, function (done) {

                expect(function () {

                    Joi.any().valid(true, 1, &#039;hello&#039;, new Date());
                }).not.to.throw();
                done();
            });

            it(&#039;throws when passed undefined&#039;, function (done) {

                expect(function () {

                    Joi.any().invalid(undefined);
                }).to.throw(&#039;Cannot call allow/valid/invalid with undefined&#039;);
                done();
            });
        });
    });
});</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ cyclomatic }} <br>
    Length : {{ halstead.length }} <br>
    Difficulty : {{ halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
